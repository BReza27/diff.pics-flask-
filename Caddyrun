#!/bin/bash

# Decrypt environment variables
export AWS_ACCESS_KEY=`echo "LS0tLS1CRUdJTiBQR1AgTUVTU0FHRS0tLS0tClZlcnNpb246IEdudVBHIHYxCgpqQTBFQ1FNQ1B4RUZZdkRBaFM1ZzBrb0JWQUVxRTREL2VjckRrMm80ZDBPa3JEbXAvR0NKSzBZMElwTEpQTEdaCkNMeTRhK1BJNmF1S1JYVFVWS2t6R0FkbVRXK05XUFBUc1BWODRVTTVNS3YrZVFrZ3JvOC9jVzUxUXc9PQo9YWVPRwotLS0tLUVORCBQR1AgTUVTU0FHRS0tLS0tCg==" | base64 --decode | gpg --passphrase "$MYSQL" 2>/dev/null`
export AWS_SECRET_ACCESS_KEY=`echo "LS0tLS1CRUdJTiBQR1AgTUVTU0FHRS0tLS0tClZlcnNpb246IEdudVBHIHYxCgpqQTBFQ1FNQ0x4WlFWZ3hob3FKZzBsNEJ2SnN5K1dSOGRTZGlmQTNiTnczMmJUazZ3cVhaOHdPWUFKTVZHdC82ClFOZ2NTSFQrUnVZbkNhRXh6ZWtlSjY3b0dqcTJheW5LT3pUTmFKSnozRnROWHN2bFZEbnNFWlFJVFRzSVZ6YnQKR3F2QnhPdlRObzY5OEhveDRHZWsKPS9xZDUKLS0tLS1FTkQgUEdQIE1FU1NBR0UtLS0tLQo=" | base64 --decode | gpg --passphrase "$MYSQL" 2>/dev/null`
export NETLIFY_ACCESS_TOKEN=`echo "LS0tLS1CRUdJTiBQR1AgTUVTU0FHRS0tLS0tClZlcnNpb246IEdudVBHIHYxCgpqQTBFQ1FNQ1lMOW1qSzBPRDdsZzBtOEJGaXlXRnpFVzF4ZDNUeTFTajdvZWROU0IyMDJOVXQ4Q0h2clNDYlQ0CnBxUmZOL2Y3bVhra3pHSG5Uemd1SzhPMGYwMmxDN2JrOVdaa3FFWFNXMFhnNStMbVNFS0pqcmk3VnF0WmhMY0YKOG5aOE1Qa2VwNlFaZVZVSW55aTZ3a2llSkhMbzhLcGxBc2NOM21rd2Z0bz0KPUw2d0YKLS0tLS1FTkQgUEdQIE1FU1NBR0UtLS0tLQo=" | base64 --decode | gpg --passphrase "$MYSQL" 2>/dev/null`

# Set gopath to something that works
IMPORT_PATH=github.com/fugiman/api.diff.pics
export GOPATH=`pwd`/.GOPATH
mkdir -p `dir .GOPATH/src/$IMPORT_PATH`
ln -s ../../../.. .GOPATH/src/$IMPORT_PATH

# Run it
go install $IMPORT_PATH/server
.GOPATH/bin/server
